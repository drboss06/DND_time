<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>D&D Countdown</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#070a12;
      --card:#0f1626;
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Manrope, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 15% 20%, rgba(99,102,241,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 30%, rgba(34,211,238,.12), transparent 55%),
        radial-gradient(900px 700px at 55% 95%, rgba(245,158,11,.10), transparent 60%),
        var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 26px 14px;
    }

    .card{
      width:min(820px, 100%);
      position:relative;
      border-radius: var(--radius);
      padding: 1px;
      box-shadow: var(--shadow);
      background: linear-gradient(135deg, rgba(99,102,241,.35), rgba(34,211,238,.20), rgba(245,158,11,.18));
    }
    .inner{
      border-radius: calc(var(--radius) - 1px);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.08);
      padding: 22px 20px 16px;
      backdrop-filter: blur(10px);
    }

    h1{
      margin: 0 0 10px;
      font-size: clamp(20px, 3vw, 28px);
      font-weight: 800;
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .pill{
      font-size: 12px;
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.85);
      background: rgba(0,0,0,.18);
    }

    /* ‚úÖ –¢–∞–π–º–µ—Ä —Ç–µ–ø–µ—Ä—å —Å–µ—Ç–∫–æ–π: [–¥–Ω–∏] : [—á–∞—Å—ã] : [–º–∏–Ω] : [—Å–µ–∫] */
    .time{
      display:grid;
      grid-template-columns: 1fr auto 1fr auto 1fr auto 1fr;
      align-items:end;
      column-gap: 12px;
      font-variant-numeric: tabular-nums;
      margin: 10px 0 6px;
      white-space: nowrap;
    }
    .seg{
      text-align:center;
      font-size: clamp(44px, 8vw, 84px);
      font-weight: 800;
      line-height: 1.0;
      letter-spacing: 1px;
      min-width: 2ch;
    }
    .sep{
      text-align:center;
      font-size: clamp(36px, 7vw, 72px);
      font-weight: 800;
      line-height: 1.0;
      opacity: .55;
      transform: translateY(-2px);
      user-select:none;
    }

    /* ‚úÖ –ü–æ–¥–ø–∏—Å–∏ —Ç–æ–∂–µ grid 4 –∫–æ–ª–æ–Ω–∫–∏ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ */
    .labels{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .2px;
      margin-top: 2px;
    }
    .labels span{ text-align:center }

    .sub{
      margin: 12px 0 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
    }

    .bottom{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{
      background: rgba(255,255,255,.14);
      border-color: rgba(255,255,255,.18);
    }
    .btn:active{ transform: translateY(1px) }

    .toast{
      color: var(--muted);
      font-size: 13px;
      min-height: 18px;
    }

    @media (prefers-reduced-motion: reduce){
      .btn{ transition:none }
    }
  </style>
</head>

<body>
  <main class="card">
    <section class="inner">
      <h1>
        üé≤ –î–æ D&amp;D –æ—Å—Ç–∞–ª–æ—Å—å
        <span class="pill">—Å—É–±–±–æ—Ç–∞ ¬∑ 14:00</span>
      </h1>

      <!-- ‚úÖ –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Äî 4 —Å–µ–≥–º–µ–Ω—Ç–∞ + —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ -->
      <div class="time" aria-label="–¢–∞–π–º–µ—Ä">
        <span class="seg" id="d">--</span>
        <span class="sep">:</span>
        <span class="seg" id="h">--</span>
        <span class="sep">:</span>
        <span class="seg" id="m">--</span>
        <span class="sep">:</span>
        <span class="seg" id="s">--</span>
      </div>

      <div class="labels" aria-hidden="true">
        <span>–¥–Ω–∏</span><span>—á–∞—Å—ã</span><span>–º–∏–Ω</span><span>—Å–µ–∫</span>
      </div>

      <p class="sub" id="nextLine">‚Äî</p>

      <div class="bottom">
        <button class="btn" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è</button>
        <span class="toast" id="toast" role="status" aria-live="polite"></span>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script>
    const { DateTime } = luxon;

    const ZONE = "Asia/Krasnoyarsk";
    const WEEKDAY_SATURDAY = 6; // 1=–ü–Ω ... 7=–í—Å
    const HOUR = 14, MIN = 0;

    const el = {
      d: document.getElementById("d"),
      h: document.getElementById("h"),
      m: document.getElementById("m"),
      s: document.getElementById("s"),
      next: document.getElementById("nextLine"),
      toast: document.getElementById("toast"),
      copy: document.getElementById("copyBtn"),
    };

    let lastRemain = { d: 0, h: 0, m: 0, s: 0 };

    const pad2 = (n) => String(n).padStart(2, "0");

    function nextSessionStart(nowZ){
      const daysUntil = (WEEKDAY_SATURDAY - nowZ.weekday + 7) % 7;
      let start = nowZ.plus({ days: daysUntil })
        .set({ hour: HOUR, minute: MIN, second: 0, millisecond: 0 });
      if (nowZ >= start) start = start.plus({ days: 7 });
      return start;
    }

    function splitSeconds(totalSeconds){
      const s = Math.max(0, totalSeconds | 0);
      const d = Math.floor(s / 86400);
      const h = Math.floor((s % 86400) / 3600);
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      return { d, h, m, s: sec };
    }

    function formatClock(rem){
      return `${pad2(rem.d)}:${pad2(rem.h)}:${pad2(rem.m)}:${pad2(rem.s)}`;
    }
    function formatText(rem){
      return `${rem.d}–¥ ${rem.h}—á ${rem.m}–º ${rem.s}—Å`;
    }

    function showToast(msg){
      el.toast.textContent = msg;
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => (el.toast.textContent = ""), 1600);
    }

    async function copyRemaining(){
      const text = `–î–æ D&D –æ—Å—Ç–∞–ª–æ—Å—å: ${formatText(lastRemain)}`;
      try{
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          const ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
        }
        showToast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ");
      } catch {
        showToast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å üôÉ");
      }
    }

    function tick(){
      const nowZ = DateTime.now().setZone(ZONE);
      const start = nextSessionStart(nowZ);
      const remainSec = Math.floor(start.diff(nowZ, "seconds").seconds);

      lastRemain = splitSeconds(remainSec);

      // ‚úÖ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
      el.d.textContent = pad2(lastRemain.d);
      el.h.textContent = pad2(lastRemain.h);
      el.m.textContent = pad2(lastRemain.m);
      el.s.textContent = pad2(lastRemain.s);

      const nice = start.setLocale("ru").toFormat("cccc, d LLLL yyyy '–≤' HH:mm");
      el.next.textContent = `–°–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä—Ç–∏—è: ${nice}`;

      document.title = `D&D ‚Äî ${formatClock(lastRemain)}`;
    }

    el.copy.addEventListener("click", copyRemaining);
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
